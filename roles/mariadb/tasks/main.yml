---
# tasks file for mariadb
  # In Centos 7 mysql is no longer defaultly available you must use mariadb
  - name: Install Pre reqs and mariadb
    yum: name={{item}} state=present update_cache=yes
    with_items:
    - MySQL-python
    - mariadb-server

  - name: Add servers to /etc/hosts for local dns
    blockinfile:
      dest: /etc/hosts
      block: |
        172.19.85.6  contorl
        172.19.85.38 lb01
        172.19.85.39 app01
        172.19.85.40 app02
        172.19.85.41 db01

  - name: ensure mysql listening on all ports
    lineinfile: dest=/etc/my.cnf.d/server.cnf regexp=^bind-address
                line="bind-address={{ansible_default_ipv4.address}}"
    notify: restart mariadb

  - name: ensure Mariadb started
    service: name=mariadb state=started enabled=yes

  - name: create demo database.
    mysql_db: name={{db_name}} state=present

  - name: create dbuser user remote
    mysql_user: name={{db_user_name}} password={{db_user_pass}}
                priv={{db_name}}.*:ALL host='{{db_user_host}}' state=present