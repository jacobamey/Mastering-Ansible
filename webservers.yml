---
- hosts: webserver
  become: true
  tasks:
  # needed to install epel-release first.
  - name: Install web components
    yum: name={{item}} state=present update_cache=yes
    with_items:
    - httpd
    - mod_wsgi
    - python2-pip
    - python-virtualenv

  - name: ensure Apache started
    service: name=httpd state=started enabled=yes

  - name: Ensure mod_wsgi is enabled
    apache2_module: state=present name=wsgi
    notify: restart httpd

  - name: copy demo app source
    copy: src=/var/ansible/demo/app/ dest=/var/www/demo mode=0755
    notify: restart httpd

  - name: copy Apache virtual host config
    copy: src=/var/ansible/demo/demo.conf dest=/etc/httpd/sites-available mode=0755
    notify: restart httpd

  handlers:
  - name: restart httpd
    service: name=httpd state=restarted